<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“¡ agents-radar</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
  <style>
    :root {
      --bg:         #0B0D14;
      --bg-side:    #080A10;
      --bg-hover:   #12151F;
      --bg-active:  #1A1E2E;
      --border:     #1E2235;
      --text:       #C9D1D9;
      --muted:      #636E82;
      --dim:        #2E3547;
      --accent:     #E8A03D;
      --accent-bg:  rgba(232,160,61,0.10);
      --code-bg:    #0D1017;
      --link:       #79B8FF;
    }
    [data-theme="light"] {
      --bg:         #FAFBFC;
      --bg-side:    #F0F2F5;
      --bg-hover:   #E8ECF1;
      --bg-active:  #DDE3EA;
      --border:     #D2D8E0;
      --text:       #1C1E26;
      --muted:      #5A6678;
      --dim:        #B8C2D0;
      --accent:     #B57200;
      --accent-bg:  rgba(181,114,0,0.08);
      --code-bg:    #F0F2F5;
      --link:       #0451A5;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: 'Space Mono', 'Courier New', monospace;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      overflow: hidden;
    }

    /* â”€â”€ Layout â”€â”€ */
    #app { display: flex; flex-direction: column; height: 100vh; }

    /* â”€â”€ Header â”€â”€ */
    #hdr {
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 20px; height: 50px;
      background: var(--bg-side); border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    .brand { font-size: 14px; font-weight: 700; letter-spacing: -0.03em; display: flex; align-items: center; gap: 10px; }
    .brand-icon { font-size: 18px; animation: breathe 3s ease-in-out infinite; }
    @keyframes breathe { 0%,100%{opacity:1} 50%{opacity:0.55} }
    .brand em { color: var(--accent); font-style: normal; }
    .hdr-right { display: flex; align-items: center; gap: 14px; }
    .signal {
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--accent); box-shadow: 0 0 6px var(--accent);
      animation: blink 2s ease-in-out infinite;
    }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.25} }
    #themeBtn {
      background: none; border: 1px solid var(--border); color: var(--muted);
      padding: 4px 12px; border-radius: 4px; cursor: pointer;
      font-family: inherit; font-size: 10px; letter-spacing: 0.06em;
      transition: border-color 0.15s, color 0.15s;
    }
    #themeBtn:hover { border-color: var(--accent); color: var(--accent); }

    /* â”€â”€ Body â”€â”€ */
    #body { display: flex; flex: 1; overflow: hidden; }

    /* â”€â”€ Sidebar â”€â”€ */
    #sidebar {
      width: 222px; flex-shrink: 0;
      background: var(--bg-side); border-right: 1px solid var(--border);
      overflow-y: auto; padding: 10px 0;
    }
    #sidebar::-webkit-scrollbar { width: 3px; }
    #sidebar::-webkit-scrollbar-thumb { background: var(--dim); border-radius: 2px; }
    .side-label {
      font-size: 9px; letter-spacing: 0.14em; text-transform: uppercase;
      color: var(--dim); padding: 4px 16px 10px;
    }
    .date-hdr {
      display: flex; align-items: center; justify-content: space-between;
      padding: 5px 14px; cursor: pointer;
      font-size: 11px; font-weight: 700; color: var(--muted);
      letter-spacing: 0.04em; transition: color 0.15s; user-select: none;
    }
    .date-hdr:hover { color: var(--text); }
    .date-hdr.lit { color: var(--accent); }
    .arr { font-size: 8px; transition: transform 0.2s; display: inline-block; }
    .date-group.open .arr { transform: rotate(90deg); }
    .rpt-list { max-height: 0; overflow: hidden; transition: max-height 0.25s ease; }
    .date-group.open .rpt-list { max-height: 200px; }
    .rpt-btn {
      display: block; width: 100%; padding: 5px 14px 5px 26px;
      background: none; border: none; border-left: 2px solid transparent;
      text-align: left; cursor: pointer; font-family: inherit; font-size: 11px;
      color: var(--muted); transition: color 0.1s, background 0.1s, border-color 0.1s;
    }
    .rpt-btn:hover { background: var(--bg-hover); color: var(--text); }
    .rpt-btn.active { color: var(--accent); border-left-color: var(--accent); background: var(--accent-bg); }

    /* â”€â”€ Content â”€â”€ */
    #cwrap { flex: 1; overflow-y: auto; }
    #cwrap::-webkit-scrollbar { width: 5px; }
    #cwrap::-webkit-scrollbar-thumb { background: var(--dim); border-radius: 3px; }
    #content { max-width: 820px; margin: 0 auto; padding: 36px 48px 72px; }

    .msg {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; gap: 12px;
      height: 240px; color: var(--muted); font-size: 11px; letter-spacing: 0.05em;
    }
    .msg-icon { font-size: 36px; opacity: 0.35; }

    @keyframes fadein { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:none} }
    .fade { animation: fadein 0.3s ease; }

    /* â”€â”€ Markdown â”€â”€ */
    .md {
      font-family: 'Source Serif 4', Georgia, 'PingFang SC', 'Microsoft YaHei', serif;
      font-size: 16px; line-height: 1.8; color: var(--text);
    }
    .md h1 { font-size: 22px; font-weight: 600; margin-bottom: 20px; line-height: 1.3; letter-spacing: -0.02em; }
    .md h2 { font-size: 17px; font-weight: 600; margin: 30px 0 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
    .md h3 { font-size: 15px; font-weight: 600; margin: 20px 0 8px; }
    .md h4 { font-size: 13px; font-weight: 700; margin: 16px 0 6px; color: var(--muted); font-family: 'Space Mono', monospace; letter-spacing: 0.03em; }
    .md p { margin-bottom: 12px; }
    .md a { color: var(--link); text-decoration: none; }
    .md a:hover { text-decoration: underline; }
    .md strong { font-weight: 600; }
    .md hr { border: none; border-top: 1px solid var(--border); margin: 22px 0; }
    .md ul, .md ol { padding-left: 22px; margin-bottom: 12px; }
    .md li { margin-bottom: 4px; }
    .md li > ul, .md li > ol { margin-top: 4px; margin-bottom: 0; }
    .md blockquote { border-left: 3px solid var(--accent); padding: 6px 16px; margin: 12px 0; color: var(--muted); font-style: italic; }
    .md code {
      font-family: 'Space Mono', monospace; font-size: 12.5px;
      background: var(--code-bg); border: 1px solid var(--border);
      padding: 1px 6px; border-radius: 3px;
    }
    .md pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 6px; padding: 16px; overflow-x: auto; margin: 14px 0; }
    .md pre code { background: none; border: none; padding: 0; font-size: 12px; }
    .md table { width: 100%; border-collapse: collapse; margin: 14px 0; font-size: 13px; font-family: 'Space Mono', monospace; }
    .md th { background: var(--code-bg); border: 1px solid var(--border); padding: 7px 12px; font-size: 10px; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; color: var(--muted); }
    .md td { border: 1px solid var(--border); padding: 7px 12px; vertical-align: top; }
    .md tr:nth-child(even) td { background: var(--bg-hover); }
    .md details { border: 1px solid var(--border); border-radius: 6px; margin: 10px 0; overflow: hidden; }
    .md summary {
      cursor: pointer; padding: 8px 14px;
      font-family: 'Space Mono', monospace; font-size: 12px; color: var(--muted);
      background: var(--code-bg); user-select: none; list-style: none;
      display: flex; align-items: center; gap: 8px; transition: color 0.15s;
    }
    .md summary::-webkit-details-marker { display: none; }
    .md summary::before { content: 'â–¶'; font-size: 8px; flex-shrink: 0; }
    .md details[open] summary::before { content: 'â–¼'; }
    .md summary:hover { color: var(--text); }
    .md details > *:not(summary) { padding: 12px 14px; }

    /* â”€â”€ Mobile â”€â”€ */
    #mob-toggle { display: none; }
    @media (max-width: 680px) {
      body { overflow: auto; }
      #app { height: auto; min-height: 100vh; }
      #body { flex-direction: column; overflow: visible; }
      #cwrap { overflow: visible; }
      #sidebar {
        width: 100%; border-right: none; border-bottom: 1px solid var(--border);
        max-height: 48px; overflow: hidden; padding: 0;
        transition: max-height 0.3s ease;
      }
      #sidebar.open { max-height: 60vh; overflow-y: auto; padding: 0 0 8px; }
      #mob-toggle {
        display: flex; align-items: center; gap: 8px;
        height: 48px; padding: 0 16px; cursor: pointer;
        font-size: 11px; color: var(--muted); border-bottom: 1px solid transparent;
        transition: color 0.15s;
      }
      #mob-toggle:hover { color: var(--text); }
      #sidebar.open #mob-toggle { border-bottom-color: var(--border); }
      .side-label { margin-top: 8px; }
      #content { padding: 20px 16px 48px; }
      .md { font-size: 15px; }
    }
  </style>
</head>
<body>
<div id="app">
  <div id="hdr">
    <div class="brand">
      <span class="brand-icon">ğŸ“¡</span>
      <span>agents-<em>radar</em></span>
    </div>
    <div class="hdr-right">
      <div class="signal"></div>
      <button id="themeBtn">â— LIGHT</button>
    </div>
  </div>

  <div id="body">
    <div id="sidebar">
      <div id="mob-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">
        â˜° &nbsp;é€‰æ‹©æŠ¥å‘Š
      </div>
      <div class="side-label">REPORTS</div>
      <div id="nav"></div>
    </div>

    <div id="cwrap">
      <div id="content">
        <div class="msg"><div class="msg-icon">ğŸ“¡</div><div>æ­£åœ¨åŠ è½½â€¦</div></div>
      </div>
    </div>
  </div>
</div>

<script>
marked.use({ breaks: true, gfm: true });

// Allow <details> and <summary> which DOMPurify strips by default
DOMPurify.addHook('uponSanitizeElement', (node, data) => {
  if (data.tagName === 'details' || data.tagName === 'summary') {
    data.allowedTags[data.tagName] = true;
  }
});

function renderMarkdown(raw) {
  const html = marked.parse(raw);
  return DOMPurify.sanitize(html, {
    ADD_TAGS: ['details', 'summary'],
    ADD_ATTR: ['open'],
  });
}

const LABELS = {
  'ai-cli':      'AI CLI å·¥å…·',
  'ai-agents':   'AI Agents ç”Ÿæ€',
  'ai-web':      'å®˜ç½‘åŠ¨æ€',
  'ai-trending': 'GitHub è¶‹åŠ¿',
};

// â”€â”€ Theme â”€â”€
const htmlEl = document.documentElement;
const themeBtn = document.getElementById('themeBtn');
let theme = localStorage.getItem('ar-theme') || 'dark';

function applyTheme(t) {
  theme = t;
  htmlEl.dataset.theme = t;
  themeBtn.textContent = t === 'dark' ? 'â— LIGHT' : 'â— DARK';
  localStorage.setItem('ar-theme', t);
}
applyTheme(theme);
themeBtn.onclick = () => applyTheme(theme === 'dark' ? 'light' : 'dark');

// â”€â”€ Routing â”€â”€
function getHash() {
  const [date, report] = location.hash.slice(1).split('/');
  return /^\d{4}-\d{2}-\d{2}$/.test(date) && report ? { date, report } : null;
}

// â”€â”€ State â”€â”€
let currentKey = null;

function setContent(html) {
  document.getElementById('content').innerHTML = html;
}

async function loadReport(date, report, push = true) {
  const key = `${date}/${report}`;
  if (key === currentKey) return;
  currentKey = key;

  if (push) history.pushState(null, '', `#${key}`);

  // Sync sidebar
  document.querySelectorAll('.rpt-btn').forEach(b => b.classList.toggle('active', b.dataset.key === key));
  document.querySelectorAll('.date-hdr').forEach(h => {
    h.classList.toggle('lit', !!h.closest('.date-group').querySelector('.rpt-btn.active'));
  });
  document.querySelectorAll('.date-group').forEach(g => {
    if (g.dataset.date === date) g.classList.add('open');
  });

  // Close mobile sidebar
  document.getElementById('sidebar').classList.remove('open');

  const cwrap = document.getElementById('cwrap');
  setContent('<div class="msg"><div class="msg-icon">â³</div><div>Loadingâ€¦</div></div>');
  cwrap.scrollTop = 0;

  try {
    const res = await fetch(`./digests/${date}/${report}.md`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const raw = await res.text();
    const safe = renderMarkdown(raw);
    setContent(`<div class="md fade">${safe}</div>`);
  } catch (e) {
    setContent(`<div class="msg"><div class="msg-icon">âš ï¸</div><div>åŠ è½½å¤±è´¥ï¼š${e.message}</div></div>`);
  }
}

function buildNav(dates) {
  const nav = document.getElementById('nav');
  dates.forEach(({ date, reports }, i) => {
    const grp = document.createElement('div');
    grp.className = 'date-group' + (i === 0 ? ' open' : '');
    grp.dataset.date = date;

    const hdr = document.createElement('div');
    hdr.className = 'date-hdr';
    const dateText = document.createTextNode(date + '\u00a0');
    const arrSpan = document.createElement('span');
    arrSpan.className = 'arr';
    arrSpan.textContent = 'â–¶';
    hdr.appendChild(dateText);
    hdr.appendChild(arrSpan);
    hdr.onclick = () => grp.classList.toggle('open');

    const list = document.createElement('div');
    list.className = 'rpt-list';
    reports.forEach(r => {
      const btn = document.createElement('button');
      btn.className = 'rpt-btn';
      btn.dataset.key = `${date}/${r}`;
      btn.textContent = LABELS[r] || r;
      btn.onclick = () => loadReport(date, r);
      list.appendChild(btn);
    });

    grp.append(hdr, list);
    nav.appendChild(grp);
  });
}

window.addEventListener('popstate', () => {
  const h = getHash();
  if (h) loadReport(h.date, h.report, false);
});

// â”€â”€ Init â”€â”€
(async () => {
  try {
    const res = await fetch('./manifest.json');
    if (!res.ok) throw new Error('manifest.json not found');
    const { dates } = await res.json();
    if (!dates?.length) throw new Error('manifest is empty');

    buildNav(dates);

    const hash = getHash();
    const first = dates[0];
    if (hash && dates.find(d => d.date === hash.date && d.reports.includes(hash.report))) {
      loadReport(hash.date, hash.report, false);
    } else if (first?.reports?.length) {
      const r0 = first.reports[0];
      history.replaceState(null, '', `#${first.date}/${r0}`);
      loadReport(first.date, r0, false);
    }
  } catch (e) {
    document.getElementById('nav').innerHTML =
      '<div class="msg" style="height:80px;font-size:10px">âš ï¸ ' + e.message + '</div>';
    setContent('<div class="msg"><div class="msg-icon">ğŸ“¡</div><div>æ— æ³•åŠ è½½ manifest.json</div></div>');
  }
})();
</script>
</body>
</html>
